{"version":3,"file":"select.service.js","sourceRoot":"","sources":["select.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Subject } from 'rxjs/Rx';\r\nimport { SelectableItem } from '../model/selectable-item';\r\nimport { SelectOption } from '../model/SelectOption';\r\nimport { Injectable } from '@angular/core';\r\n\r\n\r\n\r\nexport interface OptionDelegate {\r\n  (options: SelectOption): void;\r\n}\r\n\r\n@Injectable()\r\nexport class SelectService {\r\n  private _items: SelectableItem[];\r\n  private _options: SelectOption = new SelectOption();\r\n\r\n  public itemSelectionChanged$: Subject<SelectableItem> = new Subject<SelectableItem>();\r\n  public itemsChanged$: Subject<SelectableItem[]> = new Subject<SelectableItem[]>();\r\n  public configurationChanged$: Subject<SelectOption> = new Subject<SelectOption>();\r\n  public modelChanged$: Subject<any> = new Subject<any>();\r\n\r\n  public close(): void {\r\n    if (this.Configuration.isOpen) {\r\n      this.setConfiguration(opt => opt.isOpen = false, false);\r\n    }\r\n  }\r\n\r\n  public open(): void {\r\n    if (!this.Configuration.isOpen) {\r\n      this.setConfiguration(opt => opt.isOpen = true, false);\r\n    }\r\n  }\r\n\r\n  public toggleOpen(): void {\r\n    this.setConfiguration(opt => opt.isOpen = !opt.isOpen, false);\r\n  }\r\n\r\n  public setItems(value: any[]) {\r\n    this.setConfiguration(opt => opt.items = value, true);\r\n  }\r\n\r\n  public getInternalItems(): SelectableItem[] {\r\n    return this._items;\r\n  }\r\n\r\n  public setSelection(values: any | any[]): void {\r\n    this.setConfiguration(opt => opt.model = values, true);\r\n  }\r\n\r\n  public setSelectedItemOrChild(items: SelectableItem[], destination: string) {\r\n    for (let itm of items) {\r\n      if (itm.hasChild) {\r\n        if (itm.id === destination) {\r\n          itm.selected = true;\r\n        }\r\n        this.setSelectedItemOrChild(itm.children, destination)\r\n      } else if (itm.id === destination) {\r\n        itm.selected = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getSelection(): any | any[] {\r\n    if (this.Configuration.allowMultiple) {\r\n      return this.getInternalSelection().map(v => v.data);\r\n    } else {\r\n      let result = this.getInternalSelection();\r\n      if (result && result.length > 0) {\r\n        return result[0].data;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  public getInternalSelection(): SelectableItem[] {\r\n    let selectedItems = this.getSelectedItems(this._items);\r\n    if (selectedItems && selectedItems.length > 0) {\r\n      let i = 0;\r\n      let max = this._options.maxVisibleItemCount ? this._options.maxVisibleItemCount : 0;\r\n\r\n      for (let item of selectedItems) {\r\n        item.isVisible = (i < max || max === 0) && // Max not reached or not max value\r\n          (!item.hasChild || item.children.every(child => child.selected === false)); // all my children are unselected\r\n        if (item.isVisible && max > 0) {\r\n          i++;\r\n        }\r\n      }\r\n    }\r\n    return selectedItems;\r\n  }\r\n\r\n  public toggleItemSelection(item: SelectableItem): void {\r\n    if (!this.Configuration.allowMultiple) {\r\n      this.setAllUnselected(this._items);\r\n    }\r\n    item.selected = !item.selected;\r\n    this.setConfiguration(opt => opt.model = this.getSelection(), false);\r\n    if (this.Configuration.closeOnSelection) {\r\n      this.setConfiguration(opt => opt.isOpen = false, false);\r\n    }\r\n  }\r\n\r\n  public setAllUnselected(items: SelectableItem[]) {\r\n    for (let itm of items) {\r\n      if (itm.hasChild) {\r\n        itm.selected = false;\r\n        this.setAllUnselected(itm.children)\r\n      } else {\r\n        itm.selected = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  public setConfiguration(delegate: OptionDelegate, processItems: boolean): void {\r\n    let modelBck = this._options.model;\r\n    delegate(this._options);\r\n    this.configurationChanged$.next(this._options);\r\n    if (this._options.isValid()) {\r\n      this.reconfigure(processItems);\r\n    }\r\n    // if model changed, raise event\r\n    if (modelBck !== undefined && this._options.model !== modelBck) {\r\n      this.modelChanged$.next(this._options.model);\r\n    }\r\n  }\r\n\r\n  public get Configuration(): SelectOption {\r\n    return this._options;\r\n  }\r\n\r\n  private toSelectableItems(sources: any[]): SelectableItem[] {\r\n    if (sources && Array.isArray(sources)) {\r\n      let i = 1;\r\n      return sources.map((srcItem) => {\r\n        let item;\r\n        if (srcItem[this._options.idProperty] && srcItem[this._options.idProperty] !== '' && srcItem[this._options.textProperty]) {\r\n          item = new SelectableItem(\r\n            (srcItem[this._options.idProperty] || '').toString(),\r\n            <string>srcItem[this._options.textProperty],\r\n            srcItem,\r\n            this\r\n          );\r\n        } else {\r\n          item = new SelectableItem(\r\n            i.toString(),\r\n            <string>srcItem,\r\n            srcItem,\r\n            this\r\n          );\r\n          i++;\r\n        }\r\n        if (this._options.isHierarchy()) {\r\n          item.children = this.toSelectableItems(srcItem[this._options.childProperty]);\r\n        }\r\n        return item;\r\n      });\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  private getSelectedItems(array: SelectableItem[]): SelectableItem[] {\r\n    if (this.Configuration.isValid()) {\r\n      let res: SelectableItem[] = [];\r\n      array.forEach(v => {\r\n        if (v.hasChild && v.selected === true) {\r\n          if (this._options.allowMultiple) {\r\n            if (v.children.every(child => child.selected === false)) {\r\n              res = [...res, v];\r\n            } else {\r\n              res = [...res, ...this.getSelectedItems(v.children)];\r\n            }\r\n          }\r\n        } else if (v.hasChild) {\r\n          res = [...res, ...this.getSelectedItems(v.children)];\r\n        } else if (v.selected === true) {\r\n          res = [...res, v];\r\n        }\r\n      });\r\n      return res;\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  private reconfigure(processItems: boolean): void {\r\n    if (this.Configuration.isValid()) {\r\n      this.checkConfig();\r\n      if (processItems) {\r\n        this._items = this.toSelectableItems(this.Configuration.items);\r\n        this.itemsChanged$.next(this._items);\r\n      }\r\n\r\n      let model = this.getModel();\r\n      let select: SelectableItem[] = [];\r\n      model.forEach(v => {\r\n        select = [...select, ...this.getItemForModel(v, this._items)];\r\n      });\r\n      select.forEach(v => v._selected = true);\r\n    }\r\n  }\r\n\r\n  private checkConfig() {\r\n    if (this.Configuration.allowMultiple && this.Configuration.closeOnSelection) {\r\n      this.Configuration.closeOnSelection = false;\r\n    } else if (!this.Configuration.allowMultiple && !this.Configuration.closeOnSelection) {\r\n      this.Configuration.closeOnSelection = true;\r\n    }\r\n  }\r\n  private getModel(): any[] {\r\n    if (!this.Configuration.model) {\r\n      return [];\r\n    } else if (!Array.isArray(this.Configuration.model)) {\r\n      return [this.Configuration.model];\r\n    } else {\r\n      return this.Configuration.model;\r\n    }\r\n  }\r\n\r\n  private getItemForModel(value: any, array: SelectableItem[]): SelectableItem[] {\r\n    let result: SelectableItem[] = [];\r\n    array.forEach(v => {\r\n      if (v.id === value[this.Configuration.idProperty].toString()) {\r\n        result.push(v);\r\n      }\r\n      if (this.Configuration.isHierarchy() && v.children && v.children.length > 0) {\r\n        result = [...result, ...this.getItemForModel(value, v.children)];\r\n      }\r\n    });\r\n    return result;\r\n  }\r\n}\r\n"]}